{% extends "base.html" %}

{% block title %}Worker's page{% endblock %}

{% block content %}
        <div class="mt-n3 text-white-50">
            Click the map to set a marker. A red one means the task is in progress, a blue one means it's complete.
        </div>
        <!-- Map Container -->
        <div class="container my-4">
            <div id="map-container" class="position-relative border rounded">
                <img id="map" src="{{ url_for('static', filename='Vakantiepark.jpg') }}" alt="Map" class="img-fluid rounded">

                <!-- Existing markers will be placed here -->
                {% for marker in markers %}
                    <div class="marker position-absolute"
                         data-marker-id = {{ marker.id }}
                         onclick="handleMarkerClick({{ marker.id }}, '{{ marker.text }}', {{ 'true' if current_user.is_admin() else 'false' }}, {{ 'true' if marker.complete else 'false' }})"
                         style="background-color: {{ 'blue'  if marker.complete else 'red'}}; left: {{ marker.x }}%; top: {{ marker.y }}%;">
                        <span class="marker-text bg-light text-dark rounded p-1">{{ marker.text }}</span>
                    </div>
                {% endfor %}
            </div>
        </div>
        {% if current_user.is_admin() %}
            <div class="modal fade" id="markerModal" tabindex="-1" aria-labelledby="markerModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <form id="marker-form" method="POST" action="/add_marker">
                            <div class="modal-header">
                                <h5 class="modal-title" id="markerModalLabel">Add Marker</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <input type="hidden" name="x" id="x-coord" />
                                <input type="hidden" name="y" id="y-coord" />
                                <input type="hidden" name="marker_id" id="marker-id" />
                                <div class="mb-3">
                                    <label for="marker-text" class="form-label">Message</label>
                                    <textarea class="form-control" name="text" id="marker-text" rows="3" placeholder="Enter your message here..." required></textarea>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                <button type="submit" class="btn btn-primary">Add Marker</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        {% endif %}
    {#
        <main class="chat-container">
            <div id="chat-window" class="mb-3">

            <!-- Pre ajax way of getting messages -->

              {% for message in messages %}
                <div class="message-bubble">
                  <p class="sender">{{ message.sender }}
                      <span class="message-time">
                        {% if message.timestamp.year == date.year %}
                            {{ message.timestamp.strftime("%B") }} {{ message.timestamp.strftime("%d") }}, at {{ message.timestamp.strftime("%X") }}
                        {% else %}
                            {{ message.timestamp }}
                        {% endif %}
                        </span></p>
                  <p class="message-content">{{ message.content }}</p>
                </div>
              {% endfor %}
            </div>
        </main>
    #}
{% endblock %}